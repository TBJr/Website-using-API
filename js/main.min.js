document.addEventListener("DOMContentLoaded",()=>{const cityDropdown=document.getElementById("city-dropdown");const forecastContainer=document.getElementById("weather-forecast");const unitToggle=document.getElementById("unit-toggle");const spinner=document.getElementById("loading-spinner");const summary=document.getElementById("weekly-summary");const lastUpdated=document.getElementById("last-updated");let isCelsius=true;fetch("city_coordinates.csv").then(response=>response.text()).then(data=>{Papa.parse(data,{header:true,skipEmptyLines:true,complete:results=>{const cities=results.data;cities.forEach(city=>{const option=document.createElement("option");option.value=`${city.latitude},${city.longitude}`;option.textContent=city.city;cityDropdown.appendChild(option)})}})}).catch(error=>{console.error("Error loading the CSV file:",error)});unitToggle.addEventListener("click",()=>{isCelsius=!isCelsius;unitToggle.textContent=isCelsius?"Switch to Â°F":"Switch to Â°C";if(cityDropdown.value)updateWeather()});cityDropdown.addEventListener("change",()=>{if(cityDropdown.value)updateWeather()});function updateWeather(){const[lat,lon]=cityDropdown.value.split(",");const apiUrl=`http://www.7timer.info/bin/api.pl?lon=${lon}&lat=${lat}&product=civil&output=json`;spinner.style.display="block";forecastContainer.innerHTML="";summary.textContent="";fetch(apiUrl).then(response=>response.json()).then(data=>{displayWeather(data)}).catch(error=>{console.error("Error fetching weather data:",error);forecastContainer.innerHTML="<p>Failed to retrieve weather data. Please try again later.</p>"}).finally(()=>{spinner.style.display="none"})}function displayWeather(data){const forecast=data.dataseries;const temps=forecast.map(day=>day.temp2m);const avgTemp=temps.reduce((sum,temp)=>sum+temp,0)/temps.length;summary.textContent=`This week's average temperature is ${isCelsius?avgTemp.toFixed(1)+"Â°C":avgTemp*9/5+32+"Â°F"}.`;forecast.forEach((day,index)=>{if(index>=7)return;const weatherDay=document.createElement("div");weatherDay.classList.add("weather-day","col-md-4","mb-4");const date=new Date;date.setDate(date.getDate()+index);const dayName=date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});const temp=isCelsius?day.temp2m:day.temp2m*9/5+32;const tempUnit=isCelsius?"Â°C":"Â°F";const weatherMap={clearday:["â˜€ï¸","Clear"],clearnight:["ğŸŒ™","Clear Night"],pcloudyday:["â›…","Partly Cloudy"],pcloudynight:["ğŸŒ¤ï¸","Partly Cloudy Night"],mcloudyday:["â˜ï¸","Mostly Cloudy"],mcloudynight:["ğŸŒ¥ï¸","Mostly Cloudy Night"],cloudyday:["ğŸŒ¥ï¸","Cloudy"],cloudynight:["ğŸŒ¥ï¸","Cloudy"],humidday:["ğŸŒ«ï¸","Humid"],humidnight:["ğŸŒ«ï¸","Humid"],lightrainday:["ğŸŒ¦ï¸","Light Rain"],lightrainnight:["ğŸŒ§ï¸","Light Rain Night"],oshowerday:["ğŸŒ§ï¸","Occasional Showers"],oshowernight:["ğŸŒ§ï¸","Occasional Showers"],ishowerday:["ğŸŒ¦ï¸","Isolated Showers"],ishowernight:["ğŸŒ¦ï¸","Isolated Showers"],lightsnowday:["â„ï¸","Light Snow"],lightsnownight:["â„ï¸","Light Snow"],rainday:["ğŸŒ§ï¸","Rain"],rainnight:["ğŸŒ§ï¸","Rain"],snowday:["â„ï¸","Snow"],snownight:["â„ï¸","Snow"],rainsnowday:["ğŸŒ¨ï¸","Rain and Snow"],rainsnownight:["ğŸŒ¨ï¸","Rain and Snow"],tsday:["â›ˆï¸","Thunderstorm"],tsnight:["â›ˆï¸","Thunderstorm"],tsrainday:["â›ˆï¸","Thunderstorm with Rain"],tsrainnight:["â›ˆï¸","Thunderstorm with Rain"]};const[icon,description]=weatherMap[day.weather]||["â“","Unknown"];weatherDay.innerHTML=`
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">${dayName}</h5>
                        <p class="card-text" style="font-size: 2.5rem;">${icon}</p>
                        <p class="card-text text-uppercase" style="text-transform: uppercase; font-weight: bold;">${description}</p>
                        <p class="card-text">${temp.toFixed(1)}${tempUnit}</p>
                    </div>
                </div>
            `;forecastContainer.appendChild(weatherDay)});lastUpdated.textContent=`Last updated: ${(new Date).toLocaleString()}`}});